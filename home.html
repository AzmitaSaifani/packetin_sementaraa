<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashboard - Packetin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link href="css/styles.css" rel="stylesheet" />
    <!-- <link href="css/jam.css" rel="stylesheet" />  -->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="js/config.js"></script>
    <script src="js/server.js"></script>
  </head>
  <body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
      <!-- Navbar Brand-->
      <a class="navbar-brand ps-3" href="home.html">Packetin</a>
      <!-- Sidebar Toggle-->
      <button
        class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0"
        id="sidebarToggle"
        href="#!"
      >
        <i class="fas fa-bars"></i>
      </button>
    </nav>
    <div id="layoutSidenav">
      <div id="layoutSidenav_nav">
        <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
          <div class="sb-sidenav-menu">
            <div class="nav">
              <a class="nav-link" href="home.html">
                <div id="dashboard" class="sb-nav-link-icon">
                  <i class="fa-solid fa-house"></i>
                </div>
                Dashboard
              </a>
              <a id="tabel_datang" class="nav-link" href="tabel_datang.html">
                <div class="sb-nav-link-icon">
                  <i class="fa-solid fa-truck-fast"></i>
                </div>
                Kedatangan Paket
              </a>
              <a id="tabel_ambil" class="nav-link" href="tabel_ambil.html">
                <div class="sb-nav-link-icon">
                  <i class="fa-solid fa-dolly"></i>
                </div>
                Pengambilan Paket
              </a>
              <a id="laporan" class="nav-link" href="laporan.html">
                <div class="sb-nav-link-icon">
                  <i class="fa-regular fa-clipboard"></i>
                </div>
                Laporan Paket
              </a>
              <a id="tabel_users" class="nav-link" href="tabel_users.html">
                <div class="sb-nav-link-icon">
                  <i class="fa-solid fa-user"></i>
                </div>
                Tabel Pengguna
              </a>
              <a
                class="nav-link collapsed"
                href="#"
                onclick="showLogoutModal();"
              >
                <div class="sb-nav-link-icon">
                  <i class="fa-solid fa-right-to-bracket"></i>
                </div>
                Logout
              </a>
            </div>
          </div>
          <div class="sb-sidenav-footer">
            <div class="small">Login Sebagai:</div>
            <div id="usernameDisplay"></div>
          </div>
        </nav>
      </div>
      <div id="layoutSidenav_content">
        <main>
          <div class="container-fluid px-4">
            <h1 class="mt-4">
              Selamat Datang di Packetin,
              <span id="usernameDisplayHome"></span>!
            </h1>
            <ol class="breadcrumb mb-4"></ol>
          </div>
          <!-- Jam -->
          <div class="clock-container row container-fluid px-4 mt-5 mb-4">
            <div class="date" id="date"></div>
            <div class="clock" id="clock"></div>
            <br />
            <style>
              .clock-container {
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                /* background-color: #f8f9fa; */
                border-radius: 10px;
                /* padding: 20px; */
                /* box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); */
                /* margin: 0; */
              }

              .date {
                font-size: 1.4rem;
                font-weight: bold;
                /* margin-bottom: 1px; */
                color: #000000;
                text-align: center;
                font-family: "Arial", sans-serif;
              }

              .clock {
                font-size: 3rem;
                font-weight: bold;
                color: #000000;
                text-align: center;
                font-family: "Arial", sans-serif;
              }
            </style>
            <!-- report paket -->
            <div class="row container-fluid px-4">
              <!--Jumlah Paket Masuk -->
              <div class="col-12 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <b
                          ><div
                            class="text-xs font-weight-bold text-primary text-uppercase mb-1"
                          >
                            Paket Masuk
                          </div></b
                        >
                        <div
                          id="jumlahPaket"
                          class="h5 mb-0 font-weight-bold text-gray-800"
                        >
                          Loading...
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="fa-solid fa-truck-fast fa-2xl"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Jumlah Paket Diambil -->
              <div class="col-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <b
                          ><div
                            class="text-xs font-weight-bold text-success text-uppercase mb-1"
                          >
                            Paket Diambil
                          </div></b
                        >
                        <div
                          id="jumlahAmbil"
                          class="h5 mb-0 font-weight-bold text-gray-800"
                        >
                          Loading...
                        </div>
                      </div>
                      <div class="col-auto">
                        <!-- <i class="fa-regular fa-box-circle-check fa-2xl"></i> -->
                        <i class="fa-solid fa-dolly fa-2xl"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Pending Requests Card Example -->
              <div class="col-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <b
                          ><div
                            class="text-xs font-weight-bold text-warning text-uppercase mb-1"
                          >
                            Menunggu Konfirmasi Paket
                          </div></b
                        >
                        <div
                          id="belumAmbil"
                          class="h5 mb-0 font-weight-bold text-gray-800"
                        >
                          Loading...
                        </div>
                      </div>
                      <div class="col-auto">
                        <i
                          class="fa-solid fa-clipboard-question fa-beat fa-2xl"
                        ></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- progress -->
              <div class="col-12 mb-4">
                <div class="card border-left-info shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <b
                          ><div
                            class="text-xs font-weight-bold text-info text-uppercase mb-1"
                          >
                            Progres
                          </div></b
                        >
                        <div class="row no-gutters align-items-center">
                          <div class="col-auto">
                            <div
                              id="percentageDisplay"
                              class="h5 mb-0 mr-3 font-weight-bold text-gray-800"
                            >
                              0%
                            </div>
                          </div>
                          <div class="col">
                            <div class="progress progress-sm mr-2">
                              <div
                                id="progressBar"
                                class="progress-bar bg-info"
                                role="progressbar"
                                style="width: 0%"
                                aria-valuenow="0"
                                aria-valuemin="0"
                                aria-valuemax="100"
                              ></div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-auto">
                        <i
                          class="fa-solid fa-clipboard-check fa-beat fa-2xl"
                        ></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- modal logout -->
          <div
            class="modal fade"
            id="logoutModal"
            tabindex="-1"
            aria-labelledby="logoutModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="logoutModalLabel">Notifikasi</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">Apakah Anda yakin ingin Logout?</div>
                <div class="modal-footer">
                  <button
                    type="button"
                    id="closeInput"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Close
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger"
                    id="confirmLogout"
                  >
                    Logout
                  </button>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <!-- Session Login -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch(`${url}/session-data`, {
          credentials: "include",
        })
          .then((response) => response.json())
          .then((data) => {
            if (!data.username) {
              window.location.href = "index.html";
            } else {
              // Jika data username ada, tampilkan di elemen dengan id 'usernameDisplay'
              document.getElementById("usernameDisplay").innerText =
                data.username;

              // hide menu untuk satpam
              const username = data.username;
              fetch(`${url}/get_level?username=${username}`)
                .then((response) => response.json())
                .then((levelData) => {
                  console.log("Level data received:", levelData);
                  const level = levelData.level;

                  if (level === "Satpam") {
                    // Sembunyikan semua menu
                    console.log("Hiding elements for Satpam");
                    const tabel_users = document.getElementById("tabel_users");
                    {
                      tabel_users.style.display = "none";
                    }
                  }
                });
              }
            })
          .catch((error) => {
            console.error("Error fetching session data:", error);
          });
      });
      document
        .getElementById("confirmLogout")
        .addEventListener("click", function () {
          logout();
        });
    </script>
    <!-- selamat datang dinamis -->
    <script>
      // document.addEventListener("DOMContentLoaded", function(){
      fetch(`${url}/session-data`, {
        credentials: "include",
      })
        .then((response) => response.json())
        .then((data) => {
          if (!data.username) {
            window.location.href = "index.html";
          } else {
            // Jika data username ada, tampilkan di elemen dengan id 'usernameDisplay'
            document.getElementById("usernameDisplayHome").innerText =
              data.username;
          }
        })
        .catch((error) => {
          console.error("Error fetching session data:", error);
        });
      // });
    </script>
    <!-- jam -->
    <script>
      function updateClock() {
        const now = new Date();
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        const dateString = now.toLocaleDateString("id-ID", options);

        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        const seconds = String(now.getSeconds()).padStart(2, "0");

        const dateElement = document.getElementById("date");
        const clockElement = document.getElementById("clock");

        dateElement.textContent = dateString;
        clockElement.textContent = `${hours}:${minutes}:${seconds}`;
      }

      setInterval(updateClock, 1000);
      updateClock();
    </script>
    <!-- Jumlah Kedatangan Paket -->
    <script>
      fetch(`${url}/jumlah_paket`)
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("jumlahPaket").innerText =
            data.jumlah + " Paket";
        })
        .catch((error) => {
          console.error("Error fetching data:", error);
          document.getElementById("jumlahPaket").innerText =
            "Failed to load data";
        });
    </script>
    <!-- Jumlah sudah ambil paket -->
    <script>
      fetch(`${url}/jumlah_ambil`)
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("jumlahAmbil").innerText =
            data.jumlah + " Paket";
        })
        .catch((error) => {
          console.error("Error fetching data:", error);
          document.getElementById("jumlahAmbil").innerText =
            "Failed to load data";
        });
    </script>
    <!-- Jumlah belum ambil paket -->
    <script>
      fetch(`${url}/jumlah_belum_ambil`)
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("belumAmbil").innerText =
            data.jumlah + " Paket";
        })
        .catch((error) => {
          console.error("Error fetching data:", error);
          document.getElementById("belumAmbil").innerText =
            "Failed to load data";
        });
    </script>
    <!-- jumlah persentase total -->
    <script>
      function updateProgressBar() {
        // Mengambil total paket
        fetch(`${url}/jumlah_paket`)
          .then((response) => response.json())
          .then((totalData) => {
            const totalJumlah = totalData.jumlah;

            // Mengambil jumlah paket yang sudah diambil
            fetch(`${url}/jumlah_ambil`)
              .then((response) => response.json())
              .then((ambilData) => {
                const ambilJumlah = ambilData.jumlah;

                // Menghitung persentase
                const percentage = (ambilJumlah / totalJumlah) * 100 || 0;

                // Memperbarui progress bar
                const progressBar = document.getElementById("progressBar");
                progressBar.style.width = percentage + "%";
                progressBar.setAttribute("aria-valuenow", percentage);

                // Memperbarui tampilan persentase // Membulatkan ke angka bulat
                const percentageDisplay =
                  document.getElementById("percentageDisplay");
                percentageDisplay.textContent = Math.round(percentage) + "%";
              })
              .catch((error) =>
                console.error("Error fetching jumlah ambil:", error)
              );
          })
          .catch((error) =>
            console.error("Error fetching jumlah paket:", error)
          );
      }
      // Memanggil fungsi untuk memperbarui progress bar saat halaman dimuat
      document.addEventListener("DOMContentLoaded", updateProgressBar);
    </script>
    <!-- logout -->
    <script>
      function showLogoutModal() {
        const logoutModal = new bootstrap.Modal(
          document.getElementById("logoutModal")
        );
        logoutModal.show();
      }
      function logout() {
        event.preventDefault();
        fetch(`${url}/logout`, {
          credentials: "include",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.code == "200") {
              window.location.href = "index.html";
            } else {
              console.log("Gagal Logout");
            }
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
          });
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="js/scripts.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="assets/demo/chart-area-demo.js"></script>
    <script src="assets/demo/chart-bar-demo.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="js/datatables-simple-demo.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
